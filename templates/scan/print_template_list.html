{% extends "scan/base.html" %}

{% block title %}Templates XLSX{% endblock %}

{% block content %}
  <div class="scan-card card border-0 ui-comp-card">
    <h2 class="ui-comp-title">Templates XLSX</h2>
    <p>Gestion des templates et mappings Print Pack (superuser uniquement).</p>

    <div class="scan-table-wrap">
      <table class="scan-table">
        <thead>
          <tr>
            <th>Pack</th>
            <th>Document</th>
            <th>Variant</th>
            <th>Template XLSX</th>
            <th>Mappings</th>
            <th>Version</th>
            <th>Derni&egrave;re maj</th>
            <th>Par</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for item in templates %}
            <tr>
              <td>
                <strong>{{ item.pack_code }}</strong>
                <br>
                <small>{{ item.pack_name }}</small>
              </td>
              <td><small>{{ item.doc_type }}</small></td>
              <td><small>{{ item.variant|default:"-" }}</small></td>
              <td>
                {% if item.has_template_file %}
                  <small>{{ item.template_filename }}</small>
                  <br>
                  {% if item.template_is_uploaded %}
                    Upload&eacute;
                  {% else %}
                    Fichier source
                  {% endif %}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>{{ item.mapping_count }}</td>
              <td>
                {% if item.active_version %}
                  v{{ item.active_version }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>
                {% if item.updated_at %}
                  {{ item.updated_at|date:"d/m/Y H:i" }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>
                {% if item.updated_by %}
                  {{ item.updated_by.get_full_name|default:item.updated_by.username }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>
                <a class="scan-scan-btn btn btn-outline-primary" href="{% url 'scan:scan_print_template_edit' doc_type=item.route_key %}">
                  Modifier
                </a>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="9">Aucun template disponible.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
