<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>QR codes produits</title>
  <style>
    @page { size: A4; margin: {{ page_style.page_margin|default:"5mm" }}; }
    @media print {
      * {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }
    body {
      margin: 0;
      color: #000;
    }
    .product-qr-page {
      --page-gap: {{ page_style.page_gap|default:"2mm" }};
      --page-cols: {{ page_style.page_columns|default:3 }};
      --page-rows: {{ page_style.page_rows|default:5 }};
      --page-margin: {{ page_style.page_margin|default:"5mm" }};
      display: grid;
      grid-template-columns: repeat(var(--page-cols), minmax(0, 1fr));
      grid-template-rows: repeat(var(--page-rows), minmax(0, 1fr));
      gap: var(--page-gap);
      width: 100%;
      height: calc(297mm - (2 * var(--page-margin)));
      box-sizing: border-box;
      page-break-after: always;
    }
    .product-qr-page:last-child {
      page-break-after: auto;
    }
    .product-qr-label {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: var(--label-padding, 2mm);
      border: var(--label-border-width, 0) solid var(--label-border-color, #000);
      box-sizing: border-box;
      font-family: var(--font-family, Aptos, Arial, sans-serif);
      text-align: center;
      overflow: hidden;
    }
    .product-qr-code {
      width: var(--qr-size, 45mm);
      height: var(--qr-size, 45mm);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .product-qr-code img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    .product-qr-placeholder {
      width: 100%;
      height: 100%;
      border: 1px dashed #999;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10pt;
      color: #666;
    }
    .product-qr-text {
      margin-top: var(--text-gap, 2mm);
      font-size: var(--text-size, 12pt);
      font-weight: var(--text-weight, 600);
      line-height: 1.15;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      max-height: calc(2 * 1.15em);
      width: 100%;
    }
  </style>
</head>
<body>
  {% for page in pages %}
    <div class="product-qr-page">
      {% for label in page %}
        {% for block in label.blocks %}
          {{ block|safe }}
        {% endfor %}
      {% endfor %}
    </div>
  {% endfor %}
</body>
</html>
