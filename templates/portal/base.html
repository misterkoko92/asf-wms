{% load static %}
<!doctype html>
<html lang="fr" data-ui="classic" data-theme="classic">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Portail association{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=Manrope:wght@500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    (function() {
      try {
        var storedUi = localStorage.getItem('wms-ui');
        if (storedUi) {
          document.documentElement.setAttribute('data-ui', storedUi);
        }
        var storedTheme = localStorage.getItem('scan-theme');
        if (storedTheme) {
          document.documentElement.setAttribute('data-theme', storedTheme);
        }
      } catch (err) {
        // Ignore storage errors.
      }
    })();
  </script>
  <link rel="stylesheet" href="{% static 'scan/scan.css' %}">
  <style>
    .portal-header { display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 12px; }
    .portal-nav { display: flex; flex-wrap: wrap; gap: 10px; }
    .portal-actions { display: flex; align-items: center; gap: 10px; }
    .portal-nav a { text-decoration: none; font-weight: 600; }
    .portal-card { margin-bottom: 12px; }
    .portal-table { width: 100%; border-collapse: collapse; }
    .portal-table th, .portal-table td { padding: 7px 9px; border-bottom: 1px solid #ddd; text-align: left; }
    .portal-table th { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.04em; }
    .portal-badge { display: inline-block; padding: 2px 8px; border-radius: 999px; background: #eee; font-size: 0.8rem; }
    .portal-products-panel { display: grid; gap: 10px; }
    .portal-products-table-wrap { max-height: 420px; overflow: auto; }
    .portal-products-table-wrap .scan-table { min-width: 680px; }
    .portal-products-table-wrap .scan-table thead tr:first-child th { position: sticky; top: 0; z-index: 2; }
    .portal-products-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .portal-products-actions .scan-help { margin: 0; }
    @media (max-width: 900px) {
      .portal-products-table-wrap { max-height: 52vh; }
      .portal-products-actions .scan-submit { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="scan-shell">
    <header class="scan-card portal-card portal-header">
      <div>
        <strong>ASF WMS</strong><br>
        Portail association
      </div>
      <nav class="portal-nav">
        <a href="{% url 'portal:portal_dashboard' %}">Commandes</a>
        <a href="{% url 'portal:portal_order_create' %}">Nouvelle commande</a>
        <a href="{% url 'portal:portal_recipients' %}">Destinataires</a>
        <a href="{% url 'portal:portal_account' %}">Compte</a>
        <a href="{% url 'portal:portal_logout' %}">Déconnexion</a>
      </nav>
      <div class="portal-actions">
        <div class="scan-ui-toggle">
          <span class="scan-theme-label">Interface</span>
          <button type="button" id="portal-ui-toggle" class="scan-ui-button" aria-pressed="false">
            Classique
          </button>
        </div>
        <button
          type="button"
          id="portal-ui-reset-default"
          class="scan-ui-reset"
          title="Revenir à l'interface Benev et au thème Classique"
        >
          Benev + Classique
        </button>
      </div>
    </header>

    <main class="scan-main">
      {% if messages %}
        <div class="scan-messages">
          {% for message in messages %}
            <div class="scan-message {% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}

      {% block content %}{% endblock %}
    </main>
  </div>
  <script>
    (function() {
      var toggle = document.getElementById('portal-ui-toggle');
      if (!toggle) {
        return;
      }
      var root = document.documentElement;
      var UI_KEY = 'wms-ui';
      var UI_OPTIONS = ['classic', 'nova', 'studio', 'benev', 'timeline', 'spreadsheet'];
      var UI_LABELS = {
        classic: 'Classique',
        nova: 'Nouveau',
        studio: 'Studio',
        benev: 'Benev',
        timeline: 'Timeline',
        spreadsheet: 'Spreadsheet'
      };
      var UI_TITLES = {
        classic: 'Basculer vers Nouveau',
        nova: 'Basculer vers Studio',
        studio: 'Basculer vers Benev',
        benev: 'Basculer vers Timeline',
        timeline: 'Basculer vers Spreadsheet',
        spreadsheet: 'Basculer vers Classique'
      };
      var normalize = function(value) {
        return UI_OPTIONS.indexOf(value) !== -1 ? value : 'classic';
      };
      var applyUi = function(ui) {
        var normalized = normalize(ui);
        root.dataset.ui = normalized;
        toggle.textContent = UI_LABELS[normalized] || 'Classique';
        toggle.setAttribute('aria-pressed', normalized === 'classic' ? 'false' : 'true');
        toggle.title = UI_TITLES[normalized] || 'Basculer vers Nouveau';
      };
      var initialUi = root.dataset.ui || 'classic';
      try {
        var stored = localStorage.getItem(UI_KEY);
        if (stored) {
          initialUi = stored;
        }
      } catch (err) {
        // Ignore storage errors.
      }
      applyUi(initialUi);
      toggle.addEventListener('click', function() {
        var current = normalize(root.dataset.ui);
        var currentIndex = UI_OPTIONS.indexOf(current);
        var nextUi = UI_OPTIONS[(currentIndex + 1) % UI_OPTIONS.length];
        applyUi(nextUi);
        try {
          localStorage.setItem(UI_KEY, nextUi);
        } catch (err) {
          // Ignore storage errors.
        }
      });

      var resetButton = document.getElementById('portal-ui-reset-default');
      if (resetButton) {
        resetButton.addEventListener('click', function() {
          root.dataset.ui = 'benev';
          root.dataset.theme = 'classic';
          applyUi('benev');
          try {
            localStorage.setItem(UI_KEY, 'benev');
            localStorage.setItem('scan-theme', 'classic');
          } catch (err) {
            // Ignore storage errors.
          }
        });
      }
    })();
  </script>
  <script defer src="{% static 'portal/portal_tables.js' %}"></script>
</body>
</html>
